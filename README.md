# compile-mermaid-markdown-action (beta)

## Purpose

Markdown is a common way to present useful information with rich formatting from a simple human readable syntax.  Especially useful is being able to highlight code blocks.

[Mermaid-JS](https://mermaid-js.github.io/mermaid/) takes this philosophy and applies it to graphs!  Taking simple human-readable syntax and returning rich graphs.

Github markdown does not automatically render mermaid to the browser, so this action does that for you so you can just worry about the markdown and not the toolchain.

## Contributing

Looking for suggestions/help in improving this action.  If there is a feature you want, or you encounter a bug, please let me know and we can work together to improve it.

## How to use

The idea is that this action is to be used within a workflow, not as a standalone action at this time.

Sample workflow (adapted from [my example repo](https://github.com/neenjaw/mermaid-markdown-test):

```yaml
name: 'Compile Mermaid'

# determine when to fire the action
on:
  push:
    paths:
      - '**/*.mermaid'
      - '**/*.md'

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Fetch the repository at its current state and the commit previous
      uses: actions/checkout@v2
      with:
        fetch-depth: 2
   
    - name: Use git diff-tree to find the mermaid/md files that have changed
      id: getfile
      run: |
        echo "::set-output name=files::$(git diff-tree --no-commit-id --name-only -r ${{ github.sha }} | grep -e '.*\.md$' -e '.*\.mermaid$' | xargs)"

    - name: Print changed files for log
      run: |
        echo ${{ steps.getfile.outputs.files }}

    - name: Parse/Compile mermaid
      uses: neenjaw/compile-mermaid-markdown-action@master
      with:
        files: ${{ steps.getfile.outputs.files }}
        output: '.resource'

    - name: Show repository directory
      run: |
        ls -lR

    - name: Create Pull Request with changed files
      id: cpr
      uses: peter-evans/create-pull-request@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: Add compiled mermaid
        title: '[MMDC] New mermaid files compiled'
        body: |
          - Auto-generated by [create-pull-request][1]

          [1]: https://github.com/peter-evans/create-pull-request
        labels: report, automated pr
    - name: Check outputs
      run: |
        echo "Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}"
        echo "Pull Request Number - ${{ steps.cpr.outputs.pr_number }}"
```
